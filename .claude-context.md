# Project Context - Medusa Backend Deployment

## Project Overview
- **Project**: VitaIntegral Store - Medusa Backend
- **Medusa Version**: 2.11.3
- **Node Version**: >= 20
- **Package Manager**: Yarn (with .yarnrc.yml)

## Deployment Goal
Deploy Medusa backend to **Coolify** using:
1. GitHub repository as source
2. Docker-based deployment
3. GitHub Actions workflow to trigger Coolify webhook on push

## Current Status

### Completed
- [x] Dockerfile created (multi-stage build with Node 20 Alpine)
- [x] docker-compose.yml created for local testing
- [x] GitHub Actions workflow created (`.github/workflows/docker-build.yml`)

### In Progress
- [ ] Set up GitHub secrets for Coolify webhook
- [ ] Configure Coolify application

### Pending
- [ ] Configure environment variables in Coolify
- [ ] Test deployment pipeline

## File Structure
```
medusapando-back/
├── .github/
│   └── workflows/
│       └── docker-build.yml    # TO CREATE - Coolify deployment workflow
├── Dockerfile                  # READY - Multi-stage build
├── docker-compose.yml          # READY - Local testing
├── medusa-config.ts           # Medusa configuration
├── package.json               # Dependencies
└── src/                       # Source code
```

## Required Environment Variables (for Coolify)
```
DATABASE_URL=postgresql://user:pass@host:5432/medusa
STORE_CORS=https://your-storefront.com
ADMIN_CORS=https://your-admin.com
AUTH_CORS=https://your-admin.com
JWT_SECRET=<generate-secure-secret>
COOKIE_SECRET=<generate-secure-secret>
PORT=9004
```

## GitHub Secrets Needed
- `COOLIFY_WEBHOOK_URL` - The webhook URL from Coolify to trigger deployment
- `COOLIFY_TOKEN` (optional) - If Coolify requires authentication

## Dockerfile Summary
- **Base**: node:20-alpine
- **Build stage**: Installs deps, builds Medusa
- **Production stage**: Copies built files, runs as non-root user
- **Port**: 9004 (configurable via PORT env)
- **Health check**: /health endpoint

## Next Steps
1. Create `.github/workflows/docker-build.yml` with Coolify webhook
2. Set up Coolify application pointing to this repo
3. Configure GitHub secrets
4. Push and test deployment

---
*Last updated: Session start*
